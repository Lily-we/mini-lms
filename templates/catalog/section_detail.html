{% extends "base.html" %}
{% block content %}
  <div class="card">
    <h2>{{ section.title }}</h2>
    {% if section.description %}<p class="small">{{ section.description }}</p>{% endif %}
    <a href="/" class="btn">← Back</a>
  </div>

  <div style="height:14px"></div>

  <div class="grid">
    {% for item in items %}
      <div class="card">
        <h3>{{ item.title }}</h3>
        <p class="small">Type: {{ item.type }}</p>

        {% if item.type == "TEXT" %}
          <div class="small">
            {{ item.data.text|default:"(no text yet)"|linebreaksbr }}
          </div>

        {% elif item.type == "LINK" %}
          <a class="btn" href="{{ item.data.url }}" target="_blank" rel="noopener">Open link</a>

{% elif item.type == "YOUTUBE" %}
  {% if item.data.youtube_id %}
    <div class="card" style="padding:14px;">
      <div class="small" style="margin-bottom:8px;">Video</div>

      {# Thumbnail always visible #}
      <a href="https://www.youtube.com/watch?v={{ item.data.youtube_id }}" target="_blank" rel="noopener">
        <img
          src="https://img.youtube.com/vi/{{ item.data.youtube_id }}/hqdefault.jpg"
          alt="YouTube thumbnail"
          style="width:100%; border-radius:12px; border:1px solid rgba(255,255,255,0.12);">
      </a>

      <div style="height:10px"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        {% if item.data.youtube_url %}
          <a class="btn" href="{{ item.data.youtube_url }}" target="_blank" rel="noopener">Open on YouTube</a>
        {% else %}
          <a class="btn" href="https://www.youtube.com/watch?v={{ item.data.youtube_id }}" target="_blank" rel="noopener">Open on YouTube</a>
        {% endif %}

        <button class="btn" type="button"
                onclick="document.getElementById('yt_{{ item.id }}').style.display='block'; this.style.display='none';">
          Play here (embed)
        </button>
      </div>

      <div id="yt_{{ item.id }}" style="display:none; margin-top:12px;">
        <div style="aspect-ratio:16/9; width:100%; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.12);">
          <iframe
            style="width:100%; height:100%; border:0;"
            src="https://www.youtube-nocookie.com/embed/{{ item.data.youtube_id }}?rel=0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
        </div>
        <p class="small" style="margin-top:8px;">
          If embed shows “Video unavailable”, your network/browser blocks YouTube embeds — use “Open on YouTube”.
        </p>
      </div>
    </div>
  {% else %}
    <p class="small">Set {"youtube_url":"https://..."} or {"youtube_id":"..."} in Admin.</p>
  {% endif %}

        {% elif item.type == "TELEGRAM" %}
          <a class="btn" href="{{ item.data.invite_url }}" target="_blank" rel="noopener">Open Telegram</a>

        {% elif item.type == "DRAWING" or item.type == "DXF" %}
  {% if item.asset %}
    <p class="small">File: {{ item.asset.title }}</p>
    <a class="btn" href="{{ item.asset.file.url }}" target="_blank" rel="noopener">Download / Open</a>
  {% else %}
    <p class="small">Attach a FileAsset in Admin.</p>
  {% endif %}

{% elif item.type == "QUIZ" %}
  {% if item.quiz and item.quiz.id %}
    <a class="btn" href="{% url 'quiz_start' item.quiz.id %}">Start Quiz</a>
  {% else %}
    <p class="small">Quiz is not linked yet. Admin → Quizzes → create a Quiz and select this ContentItem.</p>
  {% endif %}

        {% elif item.type == "ANIMATION" %}
          <p class="small">Animation will be here (light MVP).</p>

        {% else %}
          <p class="small">Unsupported item type yet.</p>
        {% endif %}
      </div>
    {% empty %}
      <div class="card">
        <p>No items yet. Add in Admin → Content items.</p>
      </div>
    {% endfor %}
  </div>
{% endblock %}